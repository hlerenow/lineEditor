lineEditor=function(e){var t=0,n=-1,i=function(n){if(!e)throw Error("该插件需要jquery支持");return this instanceof i?(this.editorContainer=e(n),this.id=t,t++,this.nowLine=0,void(this.domHtml=this.getDomTemplate())):new i(n)};return i.prototype={maxLine:40,getDomTemplate:function(){return'      <div id="lineNumberCon_'+this.id+'" class="lineNumberCon">        <div id="lineNumber_'+this.id+'" class="lineNumber">1</div>      </div>      <div id="contextEassy_'+this.id+'" class="contextEassy">            <p class="lineContext">请输入内容...</p>      </div>'},init:function(){if(!this.editorContainer)throw Error("编辑器容器不存。");e(this.editorContainer).addClass("easyCon"),this.editorContainer.html(this.domHtml),this.bodyEvent(),this.bodyEvent=function(){},this.windowResize(),this.windowResize=function(){},this.bindEvent(),e(this.editorContainer.find(".contextEassy")).attr("contenteditable","true")},bindEvent:function(){var t=this;this.activeEditor(),e(this.editorContainer).on("dragover",function(e){return e.preventDefault(),!1}),e(this.editorContainer).on("drop",function(e){return e.preventDefault(),!1}),e(this.editorContainer).on("paste",function(e){setTimeout(function(){t.wrapLine(n),t.alignLine(n),t.alignHeight(n)})}),e(this.editorContainer).keydown(function(i){if(n!==-1){if(46===i.keyCode)return i.preventDefault(),!1;setTimeout(function(){t.alignLine(n),t.alignHeight(n),t.getNowEditor(n)});var o=t.getNowLine();if(13==i.keyCode){var r=e("#contextEassy_"+n+" .lineContext"),s=e("#lineNumberCon_"+n+" .lineNumber");if(!(r.length<t.maxLine))return i.preventDefault(),!1;o++,setTimeout(t.wrapLine)}if(8==i.keyCode){var r=e("#contextEassy_"+n+" .lineContext"),s=e("#lineNumberCon_"+n+" .lineNumber"),a=r[o].textContent||r[o].innerText,l=window.getSelection().anchorOffset;if(0===o&&(0===l||1===l&&""==e.trim(a)))return i.preventDefault(),!1;if(0===l||1===l&&""==e.trim(a))return e(s[s.length-1]).remove(),void o--}}})},activeEditor:function(){var t=this;e(this.editorContainer).on("click",function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,n=t.id})},closeEditor:function(){n=-1},bodyEvent:function(){e(document.body).on("click",function(e){n=-1})},getNowLine:function(){var t=window.getSelection().anchorNode,i=0,o=0;if(0==e("#contextEassy_"+n+" .lineContext").length)e("#contextEassy_"+n).append('<p class="lineContext"><br></p>');else try{for(;1!==t.nodeType||"p"!=t.nodeName.toLowerCase();)t=e(t).parent()[0];o=e("#contextEassy_"+n+" .lineContext").index(t)}catch(e){}return o>=0&&(i=o),i},getNowEditor:function(){var t=this.getNowLine(),i=e(e("#contextEassy_"+n+" .lineContext")[t]).parent()[0].id;n=parseInt(i.split("_")[1])},alignHeight:function(t){console.log(t),lines=e("#contextEassy_"+t+" .lineContext"),lineNumers=e("#lineNumberCon_"+t+" .lineNumber");for(var n=0;n<lines.length;n++)e(lineNumers[n]).height()!=e(lines[n]).height()&&e(lineNumers[n]).css("height",e(lines[n]).height());for(var i=document.getElementById("contextEassy_"+t).childNodes,n=0;n<i.length;n++)3==i[n].nodeType&&""==e.trim(i[n].textContent)&&e(i[n]).remove()},alignLine:function(t){var n=e("#contextEassy_"+t+" .lineContext"),i=e("#lineNumberCon_"+t+" .lineNumber");if(n.length!=i.length){if(n.length>i.length)for(var o=i.length;o<n.length;o++)e("#lineNumberCon_"+t).append('<div class="lineNumber" >'+(o+1)+"</div>");if(n.length<i.length)for(var o=i.length;o>n.length;o--)e(i[o-1]).remove()}},getText:function(){for(var t=this.editorContainer.find(".lineContext"),n="",i=0;i<t.length;i++)n+=e(t[i]).text()+"\n";return n},getHtml:function(){return e(this.editorContainer.find(".contextEassy")[0]).html()},wrapLine:function(){for(var t=document.getElementById("contextEassy_"+n).childNodes,i=t.length,o=0;o<i;o++)3===t[o].nodeType&&t[o].textContent&&e.trim(t[o].textContent)?e(t[o]).wrap('<p class="lineContext"/>'):3!==t[o].nodeType||""!=e.trim(t[o].textContent)?1!==t[o].nodeType||"p"==t[o].nodeName.toLowerCase()?1!==t[o].nodeType||"p"!=t[o].nodeName.toLowerCase()||e(t[o]).hasClass("lineContext")||e(t[o]).addClass("lineContext"):e(t[o]).replaceWith('<p class="lineContext">'+e(t[o]).text()+"</p>"):(e(t[o]).remove(),o--,i--)},windowResize:function(){var n=this;e(window).on("resize",function(){for(var e=0;e<t;e++)n.alignLine(e),n.alignHeight(e)})}},i}($);