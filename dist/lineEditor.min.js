lineEditor=function(e){var t=0,n=-1,i=function(n){if(!e)throw Error("该插件需要jquery支持");return this instanceof i?(this.editorContainer=e(n),this.id=t,t++,this.nowLine=0,void(this.domHtml=this.getDomTemplate())):new i(n)};return i.prototype={maxLine:40,getDomTemplate:function(){return'      <div id="lineNumberCon_'+this.id+'" class="lineNumberCon">        <div id="lineNumber_'+this.id+'" class="lineNumber">1</div>      </div>      <div id="contextEassy_'+this.id+'" class="contextEassy" contenteditable="true">            <p class="lineContext">请输入内容...</p>      </div>'},init:function(){if(!this.editorContainer)throw Error("编辑器容器不存。");e(this.editorContainer).addClass("easyCon"),this.editorContainer.html(this.domHtml),this.bodyEvent(),this.bodyEvent=function(){},this.bindEvent()},bindEvent:function(){var t=this;this.activeEditor(),e(window).on("resize",function(){t.alignLine(),t.alignHeight()}),e(this.editorContainer).on("dragover",function(e){return e.preventDefault(),!1}),e(this.editorContainer).on("drop",function(e){return e.preventDefault(),!1}),e(this.editorContainer).on("paste",function(e){setTimeout(function(){t.wrapLine(),t.alignLine(),t.alignHeight()})}),e(this.editorContainer).keydown(function(i){if(n!==-1){if(46===i.keyCode)return i.preventDefault(),!1;setTimeout(function(){t.alignLine(),t.alignHeight(),t.getNowEditor()});var o=t.getNowLine();if(13==i.keyCode){var r=e("#contextEassy_"+n+" .lineContext"),s=e("#lineNumberCon_"+n+" .lineNumber");if(!(r.length<t.maxLine))return i.preventDefault(),!1;o++,setTimeout(t.wrapLine)}if(8==i.keyCode){var r=e("#contextEassy_"+n+" .lineContext"),s=e("#lineNumberCon_"+n+" .lineNumber"),a=r[o].textContent||r[o].innerText,l=window.getSelection().anchorOffset;if(0===o&&(0===l||1===l&&""==e.trim(a)))return i.preventDefault(),!1;if(0===l||1===l&&""==e.trim(a))return e(s[s.length-1]).remove(),void o--}}})},activeEditor:function(){var t=this;e(this.editorContainer).on("click",function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,n=t.id})},closeEditor:function(){n=-1},bodyEvent:function(){e(document.body).on("click",function(e){n=-1})},getNowLine:function(){var t=window.getSelection().anchorNode,i=0,o=0;if(0==e("#contextEassy_"+n+" .lineContext").length)e("#contextEassy_"+n).append('<p class="lineContext"><br></p>');else try{for(;1!==t.nodeType||"p"!=t.nodeName.toLowerCase();)t=e(t).parent()[0];o=e("#contextEassy_"+n+" .lineContext").index(t)}catch(e){}return o>=0&&(i=o),i},getNowEditor:function(){var t=this.getNowLine(),i=e(e("#contextEassy_"+n+" .lineContext")[t]).parent()[0].id;n=parseInt(i.split("_")[1])},alignHeight:function(){if(n!=-1){lines=e("#contextEassy_"+n+" .lineContext"),lineNumers=e("#lineNumberCon_"+n+" .lineNumber");for(var t=0;t<lines.length;t++)e(lineNumers[t]).height()!=e(lines[t]).height()&&e(lineNumers[t]).css("height",e(lines[t]).height());for(var i=document.getElementById("contextEassy_"+n).childNodes,t=0;t<i.length;t++)3==i[t].nodeType&&""==e.trim(i[t].textContent)&&e(i[t]).remove()}},alignLine:function(){if(n!=-1){var t=e("#contextEassy_"+n+" .lineContext"),i=e("#lineNumberCon_"+n+" .lineNumber");if(t.length!=i.length){if(t.length>i.length)for(var o=i.length;o<t.length;o++)e("#lineNumberCon_"+n).append('<div class="lineNumber" >'+(o+1)+"</div>");if(t.length<i.length)for(var o=i.length;o>t.length;o--)e(i[o-1]).remove()}}},getText:function(){for(var t=this.editorContainer.find(".lineContext"),n="",i=0;i<t.length;i++)n+=e(t[i]).text()+"\n";return n},getHtml:function(){return e(this.editorContainer.find(".contextEassy")[0]).html()},wrapLine:function(){for(var t=document.getElementById("contextEassy_"+n).childNodes,i=0;i<t.length;i++)3===t[i].nodeType&&t[i].textContent&&e.trim(t[i].textContent)&&e(t[i]).wrap('<p class="lineContext"/>'),3!==t[i].nodeType||t[i].textContent&&e.trim(t[i].textContent)||(e(t[i]).remove(),i--),1===t[i].nodeType&&"p"!=t[i].nodeName.toLowerCase()&&e(t[i]).replaceWith('<p class="lineContext">'+e(t[i]).text()+"</p>")}},i}($);